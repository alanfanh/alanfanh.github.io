<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keyword" content="">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
          scapy包总结 - FanHao的博客 | Fanhao&#39;s Blog
        
    </title>

    <link rel="canonical" href="https://alanfanh.github.io/2019/03/08/scapy包学习总结/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css">

    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Fannnhao&#39;s blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    

                        
                    

                        
                        <li>
                            <a href="/archives/">Archives</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    
<!-- Image to hack wechat -->
<!-- <img src="https://alanfanh.github.io/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="{{ site.baseurl }}/{% if page.header-img %}{{ page.header-img }}{% else %}{{ site.header-img }}{% endif %}" width="0" height="0"> -->

<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        background-image: url('/img/home-bg.jpg')
    }
</style>
<header class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                          <a class="tag" href="/tags/#Python" title="Python">Python</a>
                        
                    </div>
                    <h1>scapy包总结</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
                        Posted by FanHao on
                        2019-03-08
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>本文主要依据官网文档(英文)和源码相关函数用法编写。如有错误，欢迎反馈。</p>
<h3 id="scapy包介绍"><a href="#scapy包介绍" class="headerlink" title="scapy包介绍"></a>scapy包介绍</h3><p><a href="https://scapy.net/" target="_blank" rel="noopener">scapy</a>包模块主要用来构造或者伪造网络中的各种数据报文。提供了从Ether层、IP层、传输层（UDP/TCP）、数据层各层的数据报文字段的构造方法。也可以用来解析数据报文。并能实现伪造异常报文，网络攻击，探测等功能。</p>
<p>scapy模块还支持构造IPv6报文，802.11无线报文以及蓝牙报文(只支持Linux系统)。</p>
<h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><p>python3.6，scapy最新版本2.4.0，本文根据此版本编写。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install scapy</span><br></pre></td></tr></table></figure>
<h4 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h4><p>本文主要具体通过查看scapy包模块下的相关源码、查看官方文档以及开发工具程序实践，等方式总结scapy包的一些常用的用法。</p>
<p>涉及到更高深或更复杂的用法，请点击这里查看<a href="https://scapy.readthedocs.io/en/latest/" target="_blank" rel="noopener">官方文档</a>。</p>
<h4 id="构造常见协议报文"><a href="#构造常见协议报文" class="headerlink" title="构造常见协议报文"></a>构造常见协议报文</h4><p>site-packages/scapy/layers下，包含构造各种协议报文的方法。有构造其他协议报文需求的读者建议可以去看这下面的源码。</p>
<p>对于报文类，如果想知道报文类提供了字段选项，可以用ls()方法查看，如下所示</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ls(IP)</span><br></pre></td></tr></table></figure>
<h5 id="构造ICMP报文"><a href="#构造ICMP报文" class="headerlink" title="构造ICMP报文"></a>构造ICMP报文</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">str=<span class="string">'abdndjafn'</span></span><br><span class="line">pkt=IP(src,dst=<span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span>)/ICMP(type=<span class="number">8</span>)/Raw(str)</span><br></pre></td></tr></table></figure>
<h5 id="构造DHCP报文"><a href="#构造DHCP报文" class="headerlink" title="构造DHCP报文"></a>构造DHCP报文</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pkt=Ether(src=self.smac,dst=<span class="string">"ff:ff:ff:ff:ff:ff"</span>)/IP(src=self.sip,dst=<span class="string">"255.255.255.255"</span>)/UDP(sport=<span class="number">68</span>,dport=<span class="number">67</span>)/BOOTP(chaddr=[mac2str(self.smac)],ciaddr=self.ciaddr,xid=translate_id)/DHCP(options=[(<span class="string">"message-type"</span>,<span class="string">"request"</span>),(<span class="string">"hostname"</span>,self.hostname),<span class="string">"end"</span>,(<span class="string">'pad'</span>,self.pad)])</span><br></pre></td></tr></table></figure>
<h5 id="构造IGMPv2报文"><a href="#构造IGMPv2报文" class="headerlink" title="构造IGMPv2报文"></a>构造IGMPv2报文</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> scapy.contrib.igmp <span class="keyword">import</span> *</span><br><span class="line">pkt=Ether(src,dst)/ip(src,dst)/IGMP(type=<span class="number">0x11</span>,mrode=<span class="number">20</span>,gaddr=<span class="string">""</span>)/Padding(<span class="string">'000000000'</span>)</span><br></pre></td></tr></table></figure>
<h5 id="构造IGMPv3报文"><a href="#构造IGMPv3报文" class="headerlink" title="构造IGMPv3报文"></a>构造IGMPv3报文</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> scapy.contrib.igmp <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> scapy.contrib.igmp <span class="keyword">import</span> *</span><br><span class="line">a=Ether()</span><br><span class="line">b=IP(src,dst)</span><br><span class="line">c=IGMPv3(type=<span class="number">0x11</span>,mrcode=<span class="number">10</span>)</span><br><span class="line">d=IGMPv3mq(gaddr=<span class="string">''</span>,qqic=<span class="number">125</span>,qrv=<span class="number">2</span>,srcaddrs=[<span class="string">'192.168.10.1'</span>,<span class="string">'192.168.11.1'</span>])</span><br><span class="line">pkt=a/b/c/d</span><br></pre></td></tr></table></figure>
<h5 id="构造数据传输UDP报文"><a href="#构造数据传输UDP报文" class="headerlink" title="构造数据传输UDP报文"></a>构造数据传输UDP报文</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pkt=Ether(src,dst)/ip(src,dst)/UDP(sport,dport)/Raw()</span><br></pre></td></tr></table></figure>
<h5 id="构造数据传输TCP报文"><a href="#构造数据传输TCP报文" class="headerlink" title="构造数据传输TCP报文"></a>构造数据传输TCP报文</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pkt=Ether(src,dst)/ip(src,dst)/TCP(sport,dport)/Raw()</span><br></pre></td></tr></table></figure>
<h5 id="构造PPPoE报文"><a href="#构造PPPoE报文" class="headerlink" title="构造PPPoE报文"></a>构造PPPoE报文</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pkt=Ether(src,dst)/PPP()</span><br></pre></td></tr></table></figure>
<h5 id="报文长度填充"><a href="#报文长度填充" class="headerlink" title="报文长度填充"></a>报文长度填充</h5><p>报文长度填充实例如下所示</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Padding(str=<span class="string">'11111111'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Raw(load=<span class="string">'advd'</span>)</span><br></pre></td></tr></table></figure>
<p>具体参考源码site-packages/scapy/packet.py</p>
<h5 id="常用工具函数"><a href="#常用工具函数" class="headerlink" title="常用工具函数"></a>常用工具函数</h5><p>列出所有scapy中的命令或函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>lsc()</span><br></pre></td></tr></table></figure>
<p>打印查看某个函数或者类的帮助信息</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>help(sendp)</span><br></pre></td></tr></table></figure>
<p>查看报文字段信息</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ls(pkt)</span><br></pre></td></tr></table></figure>
<p>显示一个报文摘要</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pkt.summary()</span><br></pre></td></tr></table></figure>
<p>展示报文内容</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pkt.show()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pkt.display()</span><br></pre></td></tr></table></figure>
<p>显示聚合的数据包（例如，计算好了校验和的）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pkt.show2()</span><br></pre></td></tr></table></figure>
<p>返回可以生产数据包的Scapy命令</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pkt.command()</span><br></pre></td></tr></table></figure>
<p>traceroute方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Traceroute(<span class="string">'114.114.114.114'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="发送报文"><a href="#发送报文" class="headerlink" title="发送报文"></a>发送报文</h4><p>发送报文方法的源码路径</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">site-packages/scapy/sendrecv.py</span><br></pre></td></tr></table></figure>
<h5 id="send-方法"><a href="#send-方法" class="headerlink" title="send()方法"></a>send()方法</h5><p>三层以上，不能指定网络接口。</p>
<p>当loop=1时，一直发包。以下例子为发10个报文，报文间隔为1s。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">send(pkt,loop=<span class="number">0</span>,inter=<span class="number">1</span>,count=<span class="number">10</span>)</span><br></pre></td></tr></table></figure>
<h5 id="sendp-方法"><a href="#sendp-方法" class="headerlink" title="sendp()方法"></a>sendp()方法</h5><p>工作在2层，发包时必须指定网络接口。其他参数与send()方法一致。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sendp(pkt,iface,loop=<span class="number">0</span>,inter=<span class="number">1</span>,count=<span class="number">5</span>)</span><br></pre></td></tr></table></figure>
<h5 id="sendpfast-方法"><a href="#sendpfast-方法" class="headerlink" title="sendpfast()方法"></a>sendpfast()方法</h5><p>工作在二层，可以指定网络接口和速率发包。Windows平台需要其他依赖库。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sendpfast(pkt,iface,pps,mbps,loop=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<h5 id="sr-方法"><a href="#sr-方法" class="headerlink" title="sr()方法"></a>sr()方法</h5><p>发送数据包和接收响应，工作在3层（IP和ARP）。该函数返回有回应的数据包和没有回应的数据包。返回的两个列表数据，第一个就是发送的数据包及其应答组成的列表，第二个是无应答数据包组成的列表。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>sr(pkt) </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans,unans=_</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans.summary()</span><br></pre></td></tr></table></figure>
<h5 id="sr1-方法"><a href="#sr1-方法" class="headerlink" title="sr1()方法"></a>sr1()方法</h5><p>与sr类似，工作在3层(IP和ARP)。但它只返回应答发送的分组（或分组集），用来返回一个应答数据包。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pkt1=IP()/ICMP()/Padding(str)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p=sr1(pkt)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.show()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pkt=IP(dst=‘<span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span>’)/UDP()/DNS(rd=<span class="number">1</span>,qd=DNSQR(qname=‘www.baidu.com’))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans=sr1(pkt_dns)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans.show()</span><br></pre></td></tr></table></figure>
<h5 id="srp-方法"><a href="#srp-方法" class="headerlink" title="srp()方法"></a>srp()方法</h5><p>工作在二层(Ether，802.3)，返回2个列表数据，第一个为返回结果，第二个无应答数据包组成</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pkt=Ether(dst=“ff:ff:ff:ff:ff:ff”)/ARP(pdst=“<span class="number">192.168</span><span class="number">.1</span><span class="number">.0</span>/<span class="number">24</span>”,timeout=<span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans,unans=srp(pkt)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans.show()</span><br></pre></td></tr></table></figure>
<h4 id="数据包处理"><a href="#数据包处理" class="headerlink" title="数据包处理"></a>数据包处理</h4><h5 id="嗅探报文"><a href="#嗅探报文" class="headerlink" title="嗅探报文"></a>嗅探报文</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sniff(count=<span class="number">0</span>,offline=<span class="keyword">None</span>,store=<span class="keyword">True</span>,prn=<span class="keyword">None</span>,filter,timeout,iface)</span><br></pre></td></tr></table></figure>
<ul>
<li>count=200        抓到200个报文，即停止嗅探报文</li>
<li>offline=‘D:\2019H1work\igmp.pcap’    解析本地cap文件</li>
<li>prn   为报文处理函数，回调此函数对抓到的报文进行处理</li>
<li>filter=‘arp or icmp or (udp and src port 68 and dst port 67)’     过滤条件，伯克利语法</li>
<li>timeout  抓包时间，默认为None</li>
<li>store=0    避免将所有的数据包存储在内存。</li>
</ul>
<h5 id="保存数据报文"><a href="#保存数据报文" class="headerlink" title="保存数据报文"></a>保存数据报文</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pkts=sniff(filter=‘arp <span class="keyword">or</span> icmp’,iface=‘eth1’,timeout=<span class="number">120</span>)</span><br><span class="line">wrpcap(‘test.cap’,pkts)    <span class="comment">#写到当前目录test.cap中</span></span><br></pre></td></tr></table></figure>
<h5 id="读取本地数据报文"><a href="#读取本地数据报文" class="headerlink" title="读取本地数据报文"></a>读取本地数据报文</h5><p>有2种方法可以实现读取本地数据包，如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pkts= rdpcap(‘D:\\<span class="number">2019</span>H1work\\igmp.pcap’ ) </span><br><span class="line">pkts= sniff(offline=‘D:\\<span class="number">2019</span>H1work\\igmp.pcap’ )</span><br></pre></td></tr></table></figure>
<h5 id="数据包内容提取"><a href="#数据包内容提取" class="headerlink" title="数据包内容提取"></a>数据包内容提取</h5><p>其实在sniff()嗅探报文或者rdpcap()读取报文的时候，报文已经自动解析完成了。</p>
<p>我们可以直接获取报文不同层的字段值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pkts=sniff(filter=‘igmp’,iface=‘eth1’)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>type(pkts)                  <span class="comment">#报文类型</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pkts.show()                 <span class="comment">#报文列表</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pkts[<span class="number">0</span>][IP].show            <span class="comment">#第一个报文的IP层</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pkts[<span class="number">0</span>][Ether].src          <span class="comment">#第一个报文的源MAC地址</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pkts[IGMP].show()           <span class="comment">#只显示IGMP报文</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pkts[IGMP][<span class="number">0</span>][IGMP].show()  <span class="comment">#显示IGMP报文第一个报文的IGMP层字段信息</span></span><br></pre></td></tr></table></figure>
<h3 id="代码实例"><a href="#代码实例" class="headerlink" title="代码实例"></a>代码实例</h3><h4 id="实例一"><a href="#实例一" class="headerlink" title="实例一"></a>实例一</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#encoding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> psutil</span><br><span class="line"><span class="keyword">from</span> scapy.config <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> scapy.layers.all <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> scapy.packet <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> scapy.contrib.igmp <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> scapy.sendrecv <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> wmi</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IgmpSer</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="comment">#初始化参数</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.sip=<span class="string">'192.168.11.1'</span></span><br><span class="line">        self.pro_dip=<span class="string">'224.0.0.1'</span></span><br><span class="line">        self.data_dip=<span class="string">'239.192.45.86'</span></span><br><span class="line">        self.data_dmac=<span class="string">''</span></span><br><span class="line">        self.inter=<span class="number">1</span></span><br><span class="line">        self.iface_name=<span class="string">'test'</span></span><br><span class="line">        self.iface=<span class="string">"Intel(R) 82579LM Gigabit Network Connection"</span></span><br><span class="line">    <span class="comment">#选择网卡,并获取iface name,并返回网卡名列表</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">select_iface</span><span class="params">(self)</span>:</span></span><br><span class="line">        name_list=[]</span><br><span class="line">        ifaces=psutil.net_if_addrs()</span><br><span class="line">        <span class="keyword">for</span> k,v <span class="keyword">in</span> ifaces.items():</span><br><span class="line">            <span class="keyword">for</span> item <span class="keyword">in</span> v:</span><br><span class="line">                <span class="keyword">if</span> item[<span class="number">0</span>] == <span class="number">2</span> <span class="keyword">and</span> <span class="keyword">not</span> item[<span class="number">1</span>] == <span class="string">'127.0.0.1'</span>:</span><br><span class="line">                    iface.append(k)</span><br><span class="line">                <span class="keyword">elif</span> item[<span class="number">0</span>] == <span class="number">-1</span> <span class="keyword">and</span> <span class="keyword">not</span> item[<span class="number">1</span>] == <span class="string">'00-00-00-00-00-00-00-E0'</span>:</span><br><span class="line">                    <span class="comment"># iface.append((k,item[1]))</span></span><br><span class="line">                    <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">return</span> name_list</span><br><span class="line">    <span class="comment"># 获取选定网卡的MAC地址,功能无法生效</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_mac_addr</span><span class="params">(self,iface)</span>:</span></span><br><span class="line">        mac=&#123;&#125;</span><br><span class="line">        ifaces=psutil.net_if_addrs()</span><br><span class="line">        <span class="keyword">for</span> k,v <span class="keyword">in</span> ifaces.items():</span><br><span class="line">            <span class="keyword">for</span> item <span class="keyword">in</span> v:</span><br><span class="line">                <span class="keyword">if</span> k == iface <span class="keyword">and</span> item[<span class="number">0</span>] == <span class="number">-1</span> <span class="keyword">and</span> <span class="keyword">not</span> item[<span class="number">1</span>] == <span class="string">'00-00-00-00-00-00-00-E0'</span>:</span><br><span class="line">                    mac=item[<span class="number">1</span>]</span><br><span class="line">                    mac=mac.replace(<span class="string">"-"</span>,<span class="string">":"</span>)</span><br><span class="line">                    <span class="comment"># print(mac)</span></span><br><span class="line">                    <span class="comment"># print(k,item[0],item[1])</span></span><br><span class="line">        <span class="keyword">return</span> mac</span><br><span class="line">    <span class="comment">#返回网卡描述信息的列表,用以sendp传参</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_iface_desc</span><span class="params">(self)</span>:</span></span><br><span class="line">        iface_list=[]</span><br><span class="line">        w=wmi.WMI()</span><br><span class="line">        iface=w.Win32_NetworkAdapterConfiguration (IPEnabled=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">for</span> interface <span class="keyword">in</span> iface:</span><br><span class="line">            iface_desc=interface.Description</span><br><span class="line">            iface_list.append(iface_desc)</span><br><span class="line">        <span class="keyword">return</span> iface_list</span><br><span class="line">    <span class="comment">#根据组播IP生成组播Mac地址</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_multicast_mac</span><span class="params">(self,ip)</span>:</span></span><br><span class="line">        mac_s=<span class="string">'01:00:5e:'</span></span><br><span class="line">        ip_list=ip.split(<span class="string">'.'</span>)[<span class="number">1</span>:]</span><br><span class="line">        num_list=list(map(int,ip_list))</span><br><span class="line">        i=<span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> num_list[<span class="number">0</span>] &gt;= <span class="number">128</span>:</span><br><span class="line">            num_list[<span class="number">0</span>]=num_list[<span class="number">0</span>]<span class="number">-128</span></span><br><span class="line">        <span class="keyword">for</span> v <span class="keyword">in</span> num_list:</span><br><span class="line">            str=hex(v)</span><br><span class="line">            <span class="keyword">if</span> len(str)==<span class="number">3</span>:</span><br><span class="line">                str=str.replace(<span class="string">"0x"</span>,<span class="string">"0"</span>)</span><br><span class="line">                num_list[i]=str</span><br><span class="line">            <span class="keyword">elif</span> len(str)==<span class="number">4</span>:</span><br><span class="line">                str=str.replace(<span class="string">"0x"</span>,<span class="string">""</span>)</span><br><span class="line">                num_list[i]=str</span><br><span class="line">            i=i+<span class="number">1</span></span><br><span class="line">        mac_end=<span class="string">':'</span>.join(num_list)</span><br><span class="line">        mac_addr=mac_s+mac_end</span><br><span class="line">        <span class="keyword">return</span> mac_addr</span><br><span class="line">    <span class="comment">#构造、发送通用组查询报文</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">general_query</span><span class="params">(self)</span>:</span></span><br><span class="line">        srcmac=self.get_mac_addr(self.iface_name)</span><br><span class="line">        dstmac=self.get_multicast_mac(<span class="string">'224.0.0.1'</span>)</span><br><span class="line">        str=<span class="string">'00000000000000'</span></span><br><span class="line">        a=Ether(src=srcmac,dst=dstmac)</span><br><span class="line">        b=IP(src=self.sip,dst=<span class="string">'224.0.0.1'</span>)</span><br><span class="line">        c=IGMP(type=<span class="number">0x11</span>,gaddr=<span class="string">'224.2.2.4'</span>)</span><br><span class="line">        pkt=a/b/c</span><br><span class="line">        a=Ether(src=src_mac,dst=<span class="string">''</span>)</span><br><span class="line">        b=IP(src=<span class="string">''</span>,dst=<span class="string">'1.1.1.1'</span>)</span><br><span class="line">        c=IGMP(type=<span class="number">0x11</span>,gaddr=<span class="string">''</span>)</span><br><span class="line">        x=a/b/c</span><br><span class="line">        x[IGMP].igmpize()</span><br><span class="line">        <span class="comment">#pkt=IP(dst='224.0.0.1',src='192.168.11.1')/IGMP(type=0x11,gaddr='')/Padding(str)</span></span><br><span class="line">        sendp(pkt,iface=self.iface,verbose=<span class="keyword">False</span>)</span><br><span class="line">        <span class="comment"># send(pkt)</span></span><br><span class="line">    <span class="comment">#构造、发送特定组查询报文</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">general_query_speical</span><span class="params">(self)</span>:</span></span><br><span class="line">        src_mac=self.get_mac_addr(self.iface)</span><br><span class="line">        print(<span class="string">'src_mac'</span>,src_mac)</span><br><span class="line">        dst_mac=self.get_multicast_mac(self.data_dip)</span><br><span class="line">        print(<span class="string">'dst_mac'</span>,dst_mac)</span><br><span class="line">        a1=Ether(src,dst)</span><br><span class="line">        b1=IP(src=<span class="string">''</span>,dst=<span class="string">'224.0.0.1'</span>)</span><br><span class="line">        c1=IGMP(type=<span class="number">0x11</span>,gaddr=self.data_dip)</span><br><span class="line">        pkt=a1/b1/c1/Padding(str)</span><br><span class="line">        a=Ether()</span><br><span class="line">        b=IP(src=self.sip,dst=self.data_dip)</span><br><span class="line">        c=IGMP(type=<span class="number">0x11</span>,gaddr=self.data_dip)</span><br><span class="line">        pkt=a/b/c</span><br><span class="line">        <span class="comment"># send(p)</span></span><br><span class="line">        sendp(pkt,iface=self.iface,inter=<span class="number">1</span>,count=<span class="number">4</span>)</span><br><span class="line">    <span class="comment">#构造组播数据报文</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">udp_stream</span><span class="params">(self,**kwrgs)</span>:</span></span><br><span class="line">        dst_mac=self.get_multicast_mac(<span class="string">'0.0.0.0'</span>)</span><br><span class="line">        src_mac=self.get_mac_addr(self.iface)</span><br><span class="line">        print(src_mac)</span><br><span class="line">        str=<span class="string">'0000000000000'</span></span><br><span class="line">        a=Ether()</span><br><span class="line">        b=IP(src=self.sip,dst=<span class="string">'0.0.0.0'</span>,flags=<span class="number">2</span>)</span><br><span class="line">        c=UDP(sport=<span class="number">7411</span>,dport=<span class="number">7411</span>)</span><br><span class="line">        pkt=a/b/c/Raw(load=(<span class="string">"AAAAAAAaaaaaaa"</span>) + str)</span><br><span class="line">        sendp(pkt,iface=self.iface,loop=<span class="number">1</span>,inter=<span class="number">2</span>)</span><br><span class="line">        <span class="comment"># sendpfast(pkt,iface=self.iface,loop=1,mbps=8)</span></span><br><span class="line">    <span class="comment">#构造组播IPv4报文</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">ipv4_stream</span><span class="params">(self)</span>:</span></span><br><span class="line">        dst_mac=self.get_multicast_mac(self.data_dip)</span><br><span class="line">        src_mac=self.get_mac_addr(self.iface)</span><br><span class="line">        str=<span class="string">'00000000000000000000000000'</span></span><br><span class="line">        a=Ether(src=src_mac,dst=dst_mac)</span><br><span class="line">        b=IP(src=self.sip,dst=self.data_dip)</span><br><span class="line">        pkt=a/b/Padding(str)</span><br><span class="line">        sendp(pkt,iface=self.iface,loop=<span class="number">1</span>,inter=<span class="number">1</span>)</span><br><span class="line">    <span class="comment">#嗅探过滤报文</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sniff_pkt</span><span class="params">(self)</span>:</span></span><br><span class="line">        sniff(filter=<span class="string">''</span>,store=<span class="number">0</span>,timeout=<span class="number">20</span>,prn=Packet.summary,iface=self.iface)</span><br><span class="line">    <span class="comment">#对嗅探的报文，调用此函数，进行下一步处理</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parser_pkt</span><span class="params">(self,pkt)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    igmpser=IgmpSer()</span><br><span class="line">    <span class="comment"># igmpser.get_multicast_mac(ip='224.1.1.1')</span></span><br><span class="line">    <span class="comment"># print(igmpser.get_mac_addr(iface='test'))</span></span><br><span class="line">    <span class="comment"># print(igmpser.select_iface())</span></span><br><span class="line">    igmpser.general_query_speical()</span><br></pre></td></tr></table></figure>
<h4 id="实例二"><a href="#实例二" class="headerlink" title="实例二"></a>实例二</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="工具应用"><a href="#工具应用" class="headerlink" title="工具应用"></a>工具应用</h3><p>PyQt和scapy库开发发包工具，请访问我的<a href="https://github.com/alanfanh" target="_blank" rel="noopener">Github</a>。</p>
<h3 id="技术难点"><a href="#技术难点" class="headerlink" title="技术难点"></a>技术难点</h3><p>1、怎么解决在windows系统下选择指定网卡接口进行发包、嗅探的问题<br>cmd中输入命令wmic -&gt;NIC  ，查看网卡接口的Index。sendp(pkt,iface=’eth7’)</p>
<p>2、怎么解决UDP报文长度过大，能自动分片的问题<br>3、sendpfast()方法发送大流量，报type类型错误的问题</p>
<p>4、怎么解决拉起线程，持续监听报文，解析报文的问题</p>


                <hr>

                

                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/2019/03/18/Linux下shell编程相关总结/" data-toggle="tooltip" data-placement="top" title="shell编程的一些Tips">&larr; Previous Post</a>
                        </li>
                    
                    
                        <li class="next">
                            <a href="/2019/02/28/xlrd读取数据注意类型/" data-toggle="tooltip" data-placement="top" title="xlrd模块用法的一些总结">Next Post &rarr;</a>
                        </li>
                    
                </ul>

                

                
                <!-- disqus 评论框 start -->
                <div class="comment">
                    <div id="disqus_thread" class="disqus-thread"></div>
                </div>
                <!-- disqus 评论框 end -->
                

            </div>
    <!-- Side Catalog Container -->
        

    <!-- Sidebar Container -->

            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                          <a class="tag" href="/tags/#Python" title="Python">Python</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                        <li><a href="http://alanfanh.github.io" target="_blank">FanHao</a></li>
                    
                        <li><a href="#" target="_blank">Foo</a></li>
                    
                        <li><a href="http://zaaack.github.io/" target="_blank">Zack</a></li>
                    
                        <li><a href="https://yuelng.github.io/" target="_blank">YueLng</a></li>
                    
                </ul>
                
            </div>

        </div>
    </div>
</article>




<!-- disqus 公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = "hexo-theme-huxblog";
    var disqus_identifier = "https://alanfanh.github.io/2019/03/08/scapy包学习总结/";
    var disqus_url = "https://alanfanh.github.io/2019/03/08/scapy包学习总结/";

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<!-- disqus 公共JS代码 end -->






    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                
                    <li>
                        <a target="_blank" href="https://twitter.com/Alan_Fan_H">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                
                
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/alan.fan.h">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">知</i>
                            </span>
                        </a>
                    </li>
                

                

                
                    <li>
                        <a target="_blank" href="https://www.facebook.com/Alan Fan">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="https://github.com/alanfanh">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Fannnhao&#39;s blog 2020 
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("https://alanfanh.github.io/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA';
    var _gaDomain = 'test.me';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>




<!-- Baidu Tongji -->

<script>
    // dynamic User by Hux
    var _baId = '4cc1f202900';

    // Originial
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?" + _baId;
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
</script>


<!-- Side Catalog -->





<!-- Image to hack wechat -->
<img src="https://alanfanh.github.io/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
